<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ ·æœ¬ç™»è®° - ArkOne æµ‹åºæµç¨‹é…ç½®ç³»ç»Ÿ</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="page-header">
      <div>
        <a href="index.html" class="btn btn-text">â† è¿”å›é¦–é¡µ</a>
        <h1 class="page-title">æ ·æœ¬ç™»è®°</h1>
      </div>
      <div class="btn-group">
        <button class="btn btn-default" onclick="handleCancel()">å–æ¶ˆ</button>
        <button class="btn btn-primary" onclick="handleSave()">ä¿å­˜</button>
      </div>
    </div>

    <div class="form-container">
      <form id="sampleForm">
        <!-- åŸºæœ¬ä¿¡æ¯ -->
        <div class="form-section">
          <h3 class="form-section-title">åŸºæœ¬ä¿¡æ¯</h3>

          <div class="form-row">
            <div class="form-item">
              <label class="form-label required">æ ·æœ¬ç¼–å·</label>
              <input
                type="text"
                class="form-input"
                id="sampleId"
                value="AK20260224001"
                required
                placeholder="è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹å·¥è¾“å…¥"
              >
              <span class="form-hint">æ”¯æŒæ‰«ç æªè¾“å…¥</span>
            </div>

            <div class="form-item">
              <label class="form-label required">æ ·æœ¬åç§°</label>
              <input
                type="text"
                class="form-input"
                id="sampleName"
                required
                placeholder="è¯·è¾“å…¥æ ·æœ¬åç§°"
              >
            </div>
          </div>

          <div class="form-row">
            <div class="form-item">
              <label class="form-label required">æ£€éªŒé¡¹ç›®</label>
              <select class="form-select" id="projectType" required onchange="handleProjectChange()">
                <option value="">è¯·é€‰æ‹©æ£€éªŒé¡¹ç›®</option>
                <option value="å…¨è´¨ç²’æµ‹åº">å…¨è´¨ç²’æµ‹åº</option>
                <option value="PCRäº§ç‰©æµ‹åº">PCRäº§ç‰©æµ‹åº</option>
              </select>
            </div>

            <div class="form-item">
              <label class="form-label required">æ ·æœ¬ç±»å‹</label>
              <select class="form-select" id="sampleType" required disabled onchange="handleSampleTypeChange()">
                <option value="">è¯·å…ˆé€‰æ‹©æ£€éªŒé¡¹ç›®</option>
              </select>
              <span class="form-hint" id="processHint"></span>
            </div>
          </div>

          <div class="form-row">
            <div class="form-item">
              <label class="form-label required">æäº¤äºº</label>
              <input
                type="text"
                class="form-input"
                id="submitter"
                required
                placeholder="è¯·è¾“å…¥æäº¤äººå§“å"
              >
            </div>

            <div class="form-item">
              <label class="form-label required">æäº¤æ—¶é—´</label>
              <input
                type="datetime-local"
                class="form-input"
                id="submitTime"
                required
              >
            </div>
          </div>

          <div class="form-row single">
            <div class="form-item">
              <label class="form-label">å¤‡æ³¨</label>
              <textarea
                class="form-textarea"
                id="remark"
                placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- å®¹å™¨ä¿¡æ¯ -->
        <div class="form-section">
          <h3 class="form-section-title">å®¹å™¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰</h3>

          <div class="form-row">
            <div class="form-item">
              <label class="form-label">å®¹å™¨ç±»å‹</label>
              <select class="form-select" id="containerType" onchange="handleContainerTypeChange()">
                <option value="">ä¸æŒ‡å®šå®¹å™¨</option>
                <option value="96å­”æ¿">96å­”æ¿</option>
                <option value="48å­”æ¿">48å­”æ¿</option>
                <option value="è¯•ç®¡">è¯•ç®¡</option>
              </select>
            </div>

            <div class="form-item">
              <label class="form-label">å®¹å™¨ç¼–å·</label>
              <input
                type="text"
                class="form-input"
                id="containerId"
                placeholder="è¯·è¾“å…¥æˆ–æ‰«æå®¹å™¨ç¼–å·"
                disabled
              >
              <span class="form-hint">æ”¯æŒæ‰«ç æªè¾“å…¥</span>
            </div>
          </div>

          <div class="form-row">
            <div class="form-item">
              <label class="form-label">å­”ä½</label>
              <select class="form-select" id="position" disabled>
                <option value="">è¯·å…ˆé€‰æ‹©å®¹å™¨ç±»å‹</option>
              </select>
              <span class="form-hint">æˆ–ç‚¹å‡»"æŸ¥çœ‹æ¿ä½å›¾"å¯è§†åŒ–é€‰æ‹©</span>
            </div>

            <div class="form-item" style="display: flex; align-items: flex-end;">
              <button type="button" class="btn btn-default" onclick="openPlateMap()" disabled id="plateMapBtn">
                æŸ¥çœ‹æ¿ä½å›¾
              </button>
            </div>
          </div>
        </div>

        <!-- æµç¨‹é¢„è§ˆ -->
        <div class="form-section" id="processPreview" style="display: none;">
          <h3 class="form-section-title">æµç¨‹é¢„è§ˆ</h3>
          <div class="progress-bar" id="processSteps"></div>
          <div style="padding: 16px; background: #F0F9FF; border-radius: 4px; margin-top: 16px;">
            <p style="color: var(--primary-color); font-size: 14px;">
              â„¹ï¸ è¯¥æ ·æœ¬å°†æŒ‰ç…§ä»¥ä¸Šæµç¨‹è¿›è¡Œå¤„ç†ï¼Œéƒ¨åˆ†èŠ‚ç‚¹å¯èƒ½æ ¹æ®æ ·æœ¬ç±»å‹è‡ªåŠ¨è·³è¿‡
            </p>
          </div>
        </div>
      </form>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div style="margin-top: 24px; display: flex; gap: 16px; justify-content: center;">
      <button class="btn btn-default" onclick="handleBatchImport()">
        ğŸ“ æ‰¹é‡å¯¼å…¥
      </button>
      <button class="btn btn-primary" onclick="handleContinueAdd()">
        â• ç»§ç»­æ·»åŠ 
      </button>
    </div>
  </div>

  <script src="scripts.js"></script>
  <script>
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      // è®¾ç½®é»˜è®¤æäº¤æ—¶é—´ä¸ºå½“å‰æ—¶é—´
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      document.getElementById('submitTime').value = `${year}-${month}-${day}T${hours}:${minutes}`;

      // ç”Ÿæˆæ ·æœ¬ç¼–å·
      document.getElementById('sampleId').value = generateSampleId();
    });

    // æ£€éªŒé¡¹ç›®å˜æ›´
    function handleProjectChange() {
      const projectType = document.getElementById('projectType').value;
      const sampleTypeSelect = document.getElementById('sampleType');
      const processHint = document.getElementById('processHint');

      sampleTypeSelect.innerHTML = '<option value="">è¯·é€‰æ‹©æ ·æœ¬ç±»å‹</option>';

      if (projectType) {
        sampleTypeSelect.disabled = false;
        const types = mockData.sampleTypes[projectType] || [];

        types.forEach(type => {
          const option = document.createElement('option');
          option.value = type;
          option.textContent = type;
          sampleTypeSelect.appendChild(option);
        });
      } else {
        sampleTypeSelect.disabled = true;
        processHint.textContent = '';
        document.getElementById('processPreview').style.display = 'none';
      }
    }

    // æ ·æœ¬ç±»å‹å˜æ›´
    function handleSampleTypeChange() {
      const projectType = document.getElementById('projectType').value;
      const sampleType = document.getElementById('sampleType').value;
      const processHint = document.getElementById('processHint');
      const processPreview = document.getElementById('processPreview');
      const processSteps = document.getElementById('processSteps');

      if (projectType && sampleType) {
        const steps = mockData.processSteps[projectType] || [];

        // æ˜¾ç¤ºæµç¨‹æç¤º
        processHint.textContent = `å°†ä½¿ç”¨ ${projectType} æµç¨‹`;
        processHint.style.color = 'var(--success-color)';

        // æ˜¾ç¤ºæµç¨‹é¢„è§ˆ
        processPreview.style.display = 'block';
        processSteps.innerHTML = '';

        steps.forEach((step, index) => {
          const stepDiv = document.createElement('div');
          stepDiv.className = 'progress-step';

          const icon = document.createElement('div');
          icon.className = 'progress-icon';
          icon.textContent = index + 1;

          const label = document.createElement('div');
          label.className = 'progress-label';
          label.textContent = step;

          stepDiv.appendChild(icon);
          stepDiv.appendChild(label);
          processSteps.appendChild(stepDiv);
        });
      } else {
        processHint.textContent = '';
        processPreview.style.display = 'none';
      }
    }

    // å®¹å™¨ç±»å‹å˜æ›´
    function handleContainerTypeChange() {
      const containerType = document.getElementById('containerType').value;
      const containerIdInput = document.getElementById('containerId');
      const positionSelect = document.getElementById('position');
      const plateMapBtn = document.getElementById('plateMapBtn');

      if (containerType) {
        containerIdInput.disabled = false;
        positionSelect.disabled = false;
        plateMapBtn.disabled = false;

        // ç”Ÿæˆå­”ä½é€‰é¡¹
        positionSelect.innerHTML = '<option value="">è¯·é€‰æ‹©å­”ä½</option>';

        if (containerType === '96å­”æ¿') {
          const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
          for (let r = 0; r < 8; r++) {
            for (let c = 1; c <= 12; c++) {
              const position = `${rows[r]}${String(c).padStart(2, '0')}`;
              const option = document.createElement('option');
              option.value = position;
              option.textContent = position;
              positionSelect.appendChild(option);
            }
          }
        } else if (containerType === '48å­”æ¿') {
          const rows = ['A', 'B', 'C', 'D', 'E', 'F'];
          for (let r = 0; r < 6; r++) {
            for (let c = 1; c <= 8; c++) {
              const position = `${rows[r]}${String(c).padStart(2, '0')}`;
              const option = document.createElement('option');
              option.value = position;
              option.textContent = position;
              positionSelect.appendChild(option);
            }
          }
        } else {
          positionSelect.innerHTML = '<option value="">è¯•ç®¡æ— éœ€é€‰æ‹©å­”ä½</option>';
          positionSelect.disabled = true;
        }
      } else {
        containerIdInput.disabled = true;
        containerIdInput.value = '';
        positionSelect.disabled = true;
        positionSelect.innerHTML = '<option value="">è¯·å…ˆé€‰æ‹©å®¹å™¨ç±»å‹</option>';
        plateMapBtn.disabled = true;
      }
    }

    // æ‰“å¼€æ¿ä½å›¾
    function openPlateMap() {
      const containerType = document.getElementById('containerType').value;
      if (containerType === '96å­”æ¿' || containerType === '48å­”æ¿') {
        window.open('plate-map.html', '_blank');
      }
    }

    // ä¿å­˜
    function handleSave() {
      if (!validateForm('sampleForm')) {
        showMessage('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'error');
        return;
      }

      const formData = {
        sampleId: document.getElementById('sampleId').value,
        sampleName: document.getElementById('sampleName').value,
        projectType: document.getElementById('projectType').value,
        sampleType: document.getElementById('sampleType').value,
        submitter: document.getElementById('submitter').value,
        submitTime: document.getElementById('submitTime').value,
        remark: document.getElementById('remark').value,
        containerType: document.getElementById('containerType').value,
        containerId: document.getElementById('containerId').value,
        position: document.getElementById('position').value
      };

      console.log('ä¿å­˜æ ·æœ¬æ•°æ®:', formData);
      showMessage('æ ·æœ¬ç™»è®°æˆåŠŸ!', 'success');

      setTimeout(() => {
        window.location.href = 'sample-list.html';
      }, 1500);
    }

    // å–æ¶ˆ
    function handleCancel() {
      if (confirm('ç¡®å®šè¦å–æ¶ˆå—ï¼Ÿæœªä¿å­˜çš„æ•°æ®å°†ä¸¢å¤±ã€‚')) {
        window.location.href = 'index.html';
      }
    }

    // æ‰¹é‡å¯¼å…¥
    function handleBatchImport() {
      showMessage('æ‰¹é‡å¯¼å…¥åŠŸèƒ½å¼€å‘ä¸­...', 'info');
      // å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šæ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
    }

    // ç»§ç»­æ·»åŠ 
    function handleContinueAdd() {
      if (!validateForm('sampleForm')) {
        showMessage('è¯·å…ˆå®Œæˆå½“å‰æ ·æœ¬çš„ç™»è®°', 'error');
        return;
      }

      if (confirm('ä¿å­˜å½“å‰æ ·æœ¬å¹¶ç»§ç»­æ·»åŠ æ–°æ ·æœ¬ï¼Ÿ')) {
        handleSave();
        setTimeout(() => {
          location.reload();
        }, 1000);
      }
    }
  </script>
</body>
</html>
