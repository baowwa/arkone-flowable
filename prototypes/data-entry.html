<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•°æ®å½•å…¥ - ArkOne æµ‹åºæµç¨‹é…ç½®ç³»ç»Ÿ</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="page-header">
      <div>
        <a href="sample-detail.html" class="btn btn-text">â† è¿”å›è¯¦æƒ…</a>
        <h1 class="page-title">æ ·æœ¬å‰å¤„ç† - <span id="sampleId">AK20260224001</span></h1>
      </div>
      <div class="btn-group">
        <button class="btn btn-text" onclick="window.location.href='batch-data-entry.html'">æ‰¹é‡å½•å…¥æ¨¡å¼ â†’</button>
        <button class="btn btn-default" onclick="handleSaveDraft()">ğŸ’¾ ä¿å­˜è‰ç¨¿</button>
        <button class="btn btn-primary" onclick="handleSubmit()">âœ“ æäº¤</button>
      </div>
    </div>

    <!-- æ ·æœ¬ä¿¡æ¯ -->
    <div class="card">
      <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; padding: 16px; background: var(--bg-color); border-radius: 4px;">
        <div>
          <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 4px;">æ ·æœ¬ç¼–å·</div>
          <div style="font-weight: 600;">AK20260224001</div>
        </div>
        <div>
          <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 4px;">æ ·æœ¬åç§°</div>
          <div style="font-weight: 600;">Sample-01</div>
        </div>
        <div>
          <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 4px;">æ£€éªŒé¡¹ç›®</div>
          <div style="font-weight: 600;">å…¨è´¨ç²’æµ‹åº</div>
        </div>
        <div>
          <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 4px;">æ ·æœ¬ç±»å‹</div>
          <div style="font-weight: 600;">å¹³æ¿æ ·æœ¬</div>
        </div>
      </div>
    </div>

    <!-- æ•°æ®å½•å…¥è¡¨å• -->
    <div class="form-container">
      <form id="dataEntryForm">
        <div class="form-section">
          <h3 class="form-section-title">æ•°æ®å½•å…¥</h3>

          <!-- æ ¸é…¸æµ“åº¦ -->
          <div class="form-row">
            <div class="form-item">
              <label class="form-label required">æ ¸é…¸æµ“åº¦</label>
              <div style="display: flex; align-items: center; gap: 8px;">
                <input
                  type="number"
                  class="form-input"
                  id="concentration"
                  required
                  placeholder="è¯·è¾“å…¥æ ¸é…¸æµ“åº¦"
                  min="0"
                  max="1000"
                  step="0.01"
                  oninput="handleConcentrationChange()"
                  onblur="validateNumber(this, 0, 1000)"
                  style="flex: 1;"
                >
                <span style="color: var(--text-secondary); white-space: nowrap;">ng/Î¼L</span>
              </div>
              <span class="form-hint">è¯·è¾“å…¥0-1000ä¹‹é—´çš„æ•°å€¼</span>
              <span class="form-error" style="display: none;"></span>
            </div>

            <div class="form-item">
              <label class="form-label">è¡¥ddHâ‚‚O</label>
              <div style="display: flex; align-items: center; gap: 8px;">
                <input
                  type="number"
                  class="form-input"
                  id="waterVolume"
                  disabled
                  placeholder="è‡ªåŠ¨è®¡ç®—"
                  style="flex: 1; background: var(--bg-color);"
                >
                <span style="color: var(--text-secondary); white-space: nowrap;">Î¼L</span>
              </div>
              <span class="form-hint" style="color: var(--primary-color);">
                â„¹ï¸ è‡ªåŠ¨è®¡ç®—: æ ¹æ®æ ¸é…¸æµ“åº¦è‡ªåŠ¨è®¡ç®—è¡¥æ°´é‡
              </span>
            </div>
          </div>

          <!-- OD260/280 -->
          <div class="form-row">
            <div class="form-item">
              <label class="form-label">OD260/280</label>
              <input
                type="number"
                class="form-input"
                id="od260280"
                placeholder="è¯·è¾“å…¥OD260/280æ¯”å€¼"
                step="0.01"
                min="1.6"
                max="2.2"
                onblur="validateNumber(this, 1.6, 2.2)"
              >
              <span class="form-hint">æ­£å¸¸èŒƒå›´: 1.8-2.0</span>
              <span class="form-error" style="display: none;"></span>
            </div>

            <div class="form-item">
              <label class="form-label">OD260/230</label>
              <input
                type="number"
                class="form-input"
                id="od260230"
                placeholder="è¯·è¾“å…¥OD260/230æ¯”å€¼"
                step="0.01"
                min="1.8"
                max="2.5"
                onblur="validateNumber(this, 1.8, 2.5)"
              >
              <span class="form-hint">æ­£å¸¸èŒƒå›´: 2.0-2.2</span>
              <span class="form-error" style="display: none;"></span>
            </div>
          </div>

          <!-- æ“ä½œä¿¡æ¯ -->
          <div class="form-row">
            <div class="form-item">
              <label class="form-label required">æ“ä½œäºº</label>
              <select class="form-select" id="operator" required>
                <option value="">è¯·é€‰æ‹©æ“ä½œäºº</option>
                <option value="å¼ ä¸‰">å¼ ä¸‰</option>
                <option value="æå››" selected>æå››</option>
                <option value="ç‹äº”">ç‹äº”</option>
                <option value="èµµå…­">èµµå…­</option>
              </select>
            </div>

            <div class="form-item">
              <label class="form-label required">æ“ä½œæ—¶é—´</label>
              <input
                type="datetime-local"
                class="form-input"
                id="operationTime"
                required
              >
            </div>
          </div>

          <!-- å¤‡æ³¨ -->
          <div class="form-row single">
            <div class="form-item">
              <label class="form-label">å¤‡æ³¨</label>
              <textarea
                class="form-textarea"
                id="remark"
                placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- å®æ—¶éªŒè¯æç¤º -->
        <div id="validationSummary" style="display: none; padding: 16px; background: #FEF0F0; border-left: 4px solid var(--danger-color); border-radius: 4px; margin-bottom: 16px;">
          <h4 style="color: var(--danger-color); margin-bottom: 8px;">âš ï¸ è¯·ä¿®æ­£ä»¥ä¸‹é”™è¯¯:</h4>
          <ul id="validationErrors" style="margin-left: 20px; color: var(--danger-color);"></ul>
        </div>
      </form>
    </div>

    <!-- å†å²è®°å½• -->
    <div class="card">
      <h3 class="card-title">å†å²è®°å½•</h3>

      <div style="border-left: 3px solid var(--success-color); padding-left: 16px; margin-bottom: 16px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
          <div style="font-weight: 600; color: var(--text-primary);">âœ“ æ ¸é…¸æå–</div>
          <div style="font-size: 12px; color: var(--text-secondary);">2026-02-24 12:00 - æå››</div>
        </div>
        <div style="color: var(--text-regular); font-size: 14px;">
          96å­”æ¿å·: P096-001, å­”å·: B03
        </div>
      </div>

      <div style="border-left: 3px solid var(--success-color); padding-left: 16px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
          <div style="font-weight: 600; color: var(--text-primary);">âœ“ æ‘‡èŒ</div>
          <div style="font-size: 12px; color: var(--text-secondary);">2026-02-24 10:30 - ç‹äº”</div>
        </div>
        <div style="color: var(--text-regular); font-size: 14px;">
          48æ·±å­”æ¿å·: P001, å­”å·: A01<br>
          æ‘‡èŒæ—¶é—´: 09:45 - 10:30
        </div>
      </div>
    </div>

    <!-- å¸®åŠ©æç¤º -->
    <div style="padding: 16px; background: #F0F9FF; border-radius: 4px; margin-top: 16px;">
      <h4 style="color: var(--primary-color); margin-bottom: 8px;">ğŸ’¡ æ“ä½œæç¤º</h4>
      <ul style="margin-left: 20px; color: var(--text-regular); line-height: 1.8;">
        <li>å¿…å¡«å­—æ®µæ ‡è®°æœ‰çº¢è‰²æ˜Ÿå·ï¼Œè¯·ç¡®ä¿å¡«å†™å®Œæ•´</li>
        <li>æ•°å€¼å­—æ®µä¼šè¿›è¡Œå®æ—¶éªŒè¯ï¼Œè¶…å‡ºèŒƒå›´ä¼šæ˜¾ç¤ºé”™è¯¯æç¤º</li>
        <li>å…¬å¼å­—æ®µä¼šæ ¹æ®è¾“å…¥è‡ªåŠ¨è®¡ç®—ï¼Œæ— éœ€æ‰‹åŠ¨å¡«å†™</li>
        <li>ç‚¹å‡»"ä¿å­˜è‰ç¨¿"å¯æš‚å­˜æ•°æ®ï¼Œç¨åç»§ç»­ç¼–è¾‘</li>
        <li>ç‚¹å‡»"æäº¤"åæ•°æ®å°†ä¿å­˜å¹¶æµè½¬åˆ°ä¸‹ä¸€èŠ‚ç‚¹</li>
        <li>æ”¯æŒæ‰«ç æªè¾“å…¥å®¹å™¨ç¼–å·å’Œæ ·æœ¬ç¼–å·</li>
      </ul>
    </div>
  </div>

  <script src="scripts.js"></script>
  <script>
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      // è®¾ç½®é»˜è®¤æ“ä½œæ—¶é—´
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      document.getElementById('operationTime').value = `${year}-${month}-${day}T${hours}:${minutes}`;

      // è·å–URLå‚æ•°
      const urlParams = new URLSearchParams(window.location.search);
      const sampleId = urlParams.get('id') || 'AK20260224001';
      document.getElementById('sampleId').textContent = sampleId;
    });

    // æ ¸é…¸æµ“åº¦å˜åŒ– - è‡ªåŠ¨è®¡ç®—è¡¥æ°´é‡
    function handleConcentrationChange() {
      const concentration = parseFloat(document.getElementById('concentration').value);
      const waterVolumeInput = document.getElementById('waterVolume');

      if (!isNaN(concentration) && concentration > 0) {
        // ç®€åŒ–çš„å…¬å¼: å‡è®¾ç›®æ ‡æµ“åº¦50ng/Î¼L, æ€»ä½“ç§¯100Î¼L
        const targetConcentration = 50;
        const totalVolume = 100;
        const sampleVolume = (targetConcentration * totalVolume) / concentration;
        const waterVolume = totalVolume - sampleVolume;

        waterVolumeInput.value = Math.max(0, waterVolume).toFixed(2);
      } else {
        waterVolumeInput.value = '';
      }
    }

    // éªŒè¯è¡¨å•
    function validateFormData() {
      const errors = [];
      const validationSummary = document.getElementById('validationSummary');
      const validationErrors = document.getElementById('validationErrors');

      // éªŒè¯æ ¸é…¸æµ“åº¦
      const concentration = document.getElementById('concentration').value;
      if (!concentration) {
        errors.push('æ ¸é…¸æµ“åº¦ä¸ºå¿…å¡«é¡¹');
      } else {
        const value = parseFloat(concentration);
        if (value < 0 || value > 1000) {
          errors.push('æ ¸é…¸æµ“åº¦å¿…é¡»åœ¨0-1000ä¹‹é—´');
        }
      }

      // éªŒè¯OD260/280
      const od260280 = document.getElementById('od260280').value;
      if (od260280) {
        const value = parseFloat(od260280);
        if (value < 1.6 || value > 2.2) {
          errors.push('OD260/280æ¯”å€¼è¶…å‡ºæ­£å¸¸èŒƒå›´(1.6-2.2)');
        }
      }

      // éªŒè¯OD260/230
      const od260230 = document.getElementById('od260230').value;
      if (od260230) {
        const value = parseFloat(od260230);
        if (value < 1.8 || value > 2.5) {
          errors.push('OD260/230æ¯”å€¼è¶…å‡ºæ­£å¸¸èŒƒå›´(1.8-2.5)');
        }
      }

      // éªŒè¯æ“ä½œäºº
      const operator = document.getElementById('operator').value;
      if (!operator) {
        errors.push('æ“ä½œäººä¸ºå¿…å¡«é¡¹');
      }

      // éªŒè¯æ“ä½œæ—¶é—´
      const operationTime = document.getElementById('operationTime').value;
      if (!operationTime) {
        errors.push('æ“ä½œæ—¶é—´ä¸ºå¿…å¡«é¡¹');
      }

      // æ˜¾ç¤ºé”™è¯¯
      if (errors.length > 0) {
        validationErrors.innerHTML = errors.map(err => `<li>${err}</li>`).join('');
        validationSummary.style.display = 'block';
        return false;
      } else {
        validationSummary.style.display = 'none';
        return true;
      }
    }

    // ä¿å­˜è‰ç¨¿
    function handleSaveDraft() {
      const formData = {
        concentration: document.getElementById('concentration').value,
        waterVolume: document.getElementById('waterVolume').value,
        od260280: document.getElementById('od260280').value,
        od260230: document.getElementById('od260230').value,
        operator: document.getElementById('operator').value,
        operationTime: document.getElementById('operationTime').value,
        remark: document.getElementById('remark').value
      };

      console.log('ä¿å­˜è‰ç¨¿:', formData);
      storage.set('draft_data', formData);
      showMessage('è‰ç¨¿å·²ä¿å­˜', 'success');
    }

    // æäº¤
    function handleSubmit() {
      if (!validateFormData()) {
        showMessage('è¯·ä¿®æ­£è¡¨å•é”™è¯¯åå†æäº¤', 'error');
        return;
      }

      const formData = {
        sampleId: document.getElementById('sampleId').textContent,
        concentration: document.getElementById('concentration').value,
        waterVolume: document.getElementById('waterVolume').value,
        od260280: document.getElementById('od260280').value,
        od260230: document.getElementById('od260230').value,
        operator: document.getElementById('operator').value,
        operationTime: document.getElementById('operationTime').value,
        remark: document.getElementById('remark').value
      };

      console.log('æäº¤æ•°æ®:', formData);
      showMessage('æ•°æ®æäº¤æˆåŠŸï¼Œæµç¨‹å·²æµè½¬åˆ°ä¸‹ä¸€èŠ‚ç‚¹', 'success');

      // æ¸…é™¤è‰ç¨¿
      storage.remove('draft_data');

      setTimeout(() => {
        window.location.href = 'sample-detail.html?id=' + formData.sampleId;
      }, 1500);
    }

    // é¡µé¢åŠ è½½æ—¶æ¢å¤è‰ç¨¿
    window.addEventListener('load', () => {
      const draft = storage.get('draft_data');
      if (draft) {
        if (confirm('æ£€æµ‹åˆ°æœªä¿å­˜çš„è‰ç¨¿ï¼Œæ˜¯å¦æ¢å¤ï¼Ÿ')) {
          document.getElementById('concentration').value = draft.concentration || '';
          document.getElementById('waterVolume').value = draft.waterVolume || '';
          document.getElementById('od260280').value = draft.od260280 || '';
          document.getElementById('od260230').value = draft.od260230 || '';
          document.getElementById('operator').value = draft.operator || '';
          document.getElementById('operationTime').value = draft.operationTime || '';
          document.getElementById('remark').value = draft.remark || '';

          showMessage('è‰ç¨¿å·²æ¢å¤', 'info');
        }
      }
    });
  </script>
</body>
</html>
